# EmbedThis Updater - Release 1.1.2

**Release Date:** January 2025
**Tag:** v1.1.2

## Overview

Version 1.1.2 is a major stability and compatibility release that adds full Windows support, comprehensive CI/CD infrastructure, and extensive improvements to cross-platform testing. This release represents a significant milestone in making the Updater production-ready across all major platforms.

## Highlights

- **Full Windows Support** - Native Windows compilation and testing using Visual Studio
- **Comprehensive CI/CD** - Automated testing across Linux, macOS, and Windows platforms
- **Enhanced Testing** - Complete TestMe-based unit test suite with parallel execution support
- **Platform Stability** - Fixed critical platform-specific issues on Windows and Linux
- **Improved Documentation** - Man page, comprehensive README, and design documentation

## New Features

### Windows Support
- Native Windows compilation using Visual Studio 2022
- Windows-compatible SSL/TLS certificate path handling
- POSIX compatibility layer for `strtok_r` and other functions
- Process-based unique filenames for parallel test execution
- Git for Windows (bash) integration for test scripts

### CI/CD Infrastructure
- GitHub Actions workflow for automated builds
- Multi-platform testing (Linux, macOS, Windows)
- Automated test execution on every commit
- Build artifact generation and validation

### Testing Enhancements
- Complete TestMe unit test harness
- C, shell, and JavaScript test coverage
- Parallel-safe test execution with PID-based filenames
- Environment variable-based credential loading for Windows compatibility
- Removed hardcoded Unix paths (/tmp/) from tests

## Bug Fixes

### Platform-Specific Fixes
- **Windows**: Fixed `strtok_r` compatibility by mapping to `strtok_s`
- **Windows**: Fixed SSL certificate configuration and loading on Windows
- **Windows**: Fixed checksum calculation and verification on Windows
- **Linux**: Added `_POSIX_C_SOURCE 200809L` definition for `strdup()` availability
- **Linux**: Fixed API test failures related to POSIX function availability

### Test Fixes
- Fixed API test process spawning to use environment variables instead of popen()
- Removed hardcoded Unix paths in favor of portable local directories
- Added NULL checks for all `strdup()` calls with proper error handling
- Fixed Windows test failures related to file paths and temporary directories

### Build System Fixes
- Fixed Makefile phony targets for proper build behavior
- Fixed build directory naming for consistency
- Corrected CI/CD build and test processes

## Security Enhancements

- Enhanced SSL/TLS certificate validation across all platforms
- Secure file handling with platform-appropriate permissions
- Content-Length parsing tightened to prevent integer overflow
- Checksum verification using constant-time comparison

## Documentation Improvements

- Added comprehensive man page (`man updater`)
- Enhanced README with security features and CRA compliance information
- Updated DESIGN.md with architecture and implementation details
- Added CLAUDE.md for AI-assisted development guidance
- Improved inline code documentation

## Breaking Changes

None. This release maintains full backward compatibility with 1.1.1.

## Platform Support

- **Linux** (x64, ARM)
- **macOS** (x64, ARM64/M1)
- **Windows** (x64) via Visual Studio 2022 or WSL
- **ESP32** (experimental)
- **FreeRTOS** (experimental)

## Dependencies

- **OpenSSL** 1.1.1 or later (3.x recommended)
- **C Compiler**: GCC 7+, Clang 10+, or MSVC 2022+
- **TestMe**: For running unit tests
- **Bash**: For test scripts (Git for Windows on Windows)
- **Bun**: For JavaScript unit tests (optional)

## Installation

### From Source
```bash
make build
sudo make install
```

### Using the Updater
```bash
updater --host <builder-endpoint> \
        --product <product-id> \
        --token <api-token> \
        --device <device-id> \
        --version <current-version> \
        --file /path/to/update.tgz \
        --cmd /path/to/apply.sh
```

## Known Issues

- No retry logic for transient network failures
- No resume support for interrupted downloads
- Single-threaded operation only
- 100MB maximum update size limit

## Migration Guide

Users upgrading from 1.1.1 can use this release as a drop-in replacement. No configuration changes are required.

## Contributors

- EmbedThis Software Team

## Resources

- **Documentation**: https://www.embedthis.com/doc/
- **Builder Portal**: https://admin.embedthis.com/
- **GitHub**: https://github.com/embedthis/updater
- **Support**: support@embedthis.com
- **Security Issues**: security@embedthis.com

## Checksums

Release checksums will be published with the official release package.

## License

Copyright (c) EmbedThis Software. All Rights Reserved.

---

**Note**: This release follows [Semantic Versioning 2.0](https://semver.org/). For detailed change history, see [CHANGELOG.md](../logs/CHANGELOG.md).
